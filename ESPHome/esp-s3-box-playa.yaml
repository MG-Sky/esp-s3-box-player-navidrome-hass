substitutions:
  name: esp32-s3box-3
  friendly_name: ESP32-S3-Box-3
  font_file: https://github.com/chrisdunnname/esphome-s3-box-3-lvgl/raw/main/fonts/Montserrat-Regular.ttf
  font_glyphs: '&@!"''%()+=,-_.:°/$€£¥?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyzÀàÁáÂâÃãÄäĀāĂăÅåǺǻẠạĄąÆæǼǽĆćĈĉČčĊċÇçĎďĐđÐðÈèÉéÊêẼẽĚěËëĒēĔĕĖėẸẹĘęĜĝǦǧĞğĠġĢģĤĥĦħıÌìÍíÎîĨĩÏïĪīĬĭİỊịĮįȷĴĵĶķĸĹĺĽľĻļŁłĿŀŃńÑñŇňŅņƝɲŊŋŉÒòÓóÔôÕõÖöŌōŎŏŐőỌọǪǫØøǾǿŒœŔŕŘřŖŗŚśŜŝŠšŞşȘșẞßŤťŢţȚțŦŧÞþÙùÚúÛûŨũÜüŪūŬŭŮůŰűỤụŲųẀẁẂẃŴŵẄẅỲỳÝýŶŷỸỹŸÿȲȳŹźŽžŻżĲĳƏə'
  icon_font_file: https://github.com/chrisdunnname/esphome-s3-box-3-lvgl/raw/main/fonts/materialdesignicons-webfont.ttf
  

  #displayable names of playlists - remeber the order much match Lines from 342...
  playlists_text:
    - Samochodowa
    - Sorround
    - Ulubione
    - Sweta

  player_name: home_player #only entity name witohut type
  switch_1: radio_  # only entity (switch) name 
  switch_2: none  # only entity (switch) name 
  sensor_1: czujnik_1
  sensor_2: czujnik_2e
  sensor_3: czujnik_3e
  sensor_4: licznik_4r
# Line 342 here enter playlist data in formatName|ID in each line.
# line 48 here you can set brightness (startup value) = relative_brightness: 65%

globals:
  - id: playlist_options
    type: std::vector<std::string>
    restore_value: no

  
  - id: white_color
    type: Color
    restore_value: no
    initial_value: 'Color(255, 255, 255)'


  - id: selected_playlist_id
    type: std::string
    restore_value: yes

    


esphome:
  name: ${name}
  friendly_name: ${friendly_name}
  on_boot:
    then: 
      - light.dim_relative: 
          id: display_brightness_control
          relative_brightness: 72%
esp32:
  board: esp32s3box
  flash_size: 16MB
  cpu_frequency: 240MHz
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: "y"
      CONFIG_ESP32S3_DATA_CACHE_64KB: "y"
      CONFIG_ESP32S3_DATA_CACHE_LINE_64B: "y"
      CONFIG_ESP32S3_INSTRUCTION_CACHE_32KB: "y" 
      CONFIG_MBEDTLS_EXTERNAL_MEM_ALLOC: "y" 
      CONFIG_MBEDTLS_SSL_PROTO_TLS1_3: "y"



api:


ota:
  - platform: esphome
    id: ota_esphome

logger:
  hardware_uart: USB_SERIAL_JTAG
  logs:
    text_sensor: DEBUG
    component: DEBUG

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  manual_ip:
  ############## EDIT IP Configuratrion
    static_ip: 192.168.168.XXX
    gateway: 192.168.168.1
    subnet: 255.255.255.0
    dns1: 192.168.168.2
  ap:
    ssid: ${name}
    password: s3box123   


spi:
  clk_pin: GPIO7
  mosi_pin: GPIO6





output:
  - platform: ledc
    pin: GPIO47
    id: backlight_output



light:
  - platform: monochromatic
    id: display_brightness_control
   
    name: LCD Backlight
    entity_category: config
    output: backlight_output  
    default_transition_length: 50ms




display:
  - platform: ili9xxx
    id: s3_box_lcd
    model: S3BOX
    invert_colors: false
    data_rate: 40MHz
    cs_pin: 5
    dc_pin: 4
    reset_pin:
      number: 48
      inverted: true
    update_interval: never
    auto_clear_enabled: false

i2c:
  - id: bus_a
    sda: GPIO08
    scl: GPIO18
    scan: true
    sda_pullup_enabled: true
    scl_pullup_enabled: true
    frequency: 100kHz

touchscreen:
  - platform: gt911
    i2c_id: bus_a
    address: 0x5D
    id: gt911_touchscreen
    interrupt_pin:
      number: GPIO3
      ignore_strapping_warning: true

lvgl:
  id: lvgl_display
  disp_bg_color: black
  bg_color: black


  pages:
    - id: audio_player_page
      widgets:
        - obj:
            styles: page_content
            widgets:
              - obj:
                  align: TOP_MID
                  styles: header
                  widgets:
                    - label:
                        scrollbar_mode:  "OFF"
                        id: player_status
                        text: "starting..."
                        y: 4
                        align: CENTER
                        text_align: CENTER
                        text_color: 0xFFFFFF
              - obj:
                  align: BOTTOM_MID
                  styles: footer
                  widgets:
                    - label:
                        scrollbar_mode:  "ON"
                        id: bottom_status
                        text: "starting...."
                        y: 4
                        align: CENTER
                        text_align: CENTER
                        text_color: 0xFFFFFF



        # Control Buttons (Play, Stop, Next, Previous, Volume Up, Volume Down)
              - obj:
                  align: CENTER 
                  width: 100%
                  height: 65%
                  bg_color: black
                  border_width: 0        
                  radius: 6       
                  pad_all: -10
                  pad_top: 18
                  pad_left: 15 
                  pad_bottom: -3                     
                  layout:
                    type: GRID
                    grid_columns: [FR(1), FR(1), FR(1)]
                    grid_rows: [FR(1), FR(1), FR(1)]
                  widgets:
                    - button:
                        id: play_button
                        grid_cell_column_pos: 0
                        grid_cell_row_pos: 0
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F040A"  # Play Icon
                              align: CENTER
                              text_color: green
                        on_release:
                          then:
                            - homeassistant.service:
                                service: pyscript.start_queue
                                data:
                                  playlist_id: !lambda |-
                                    std::string name = id(selected_playlist_id);
                                    return name;



                    - button:
                        id: stop_button
                        grid_cell_column_pos: 0
                        grid_cell_row_pos: 1
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                            
                              text_font: icon_font_55
                              text: "\U000F04DB"  # Stop Icon
                              align: CENTER
                              text_color: red
                        on_release:
                          then:
                            - homeassistant.service:
                                service: pyscript.stop_queue
                    - button:
                        id: next_button
                        grid_cell_column_pos: 1
                        grid_cell_row_pos: 0
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F04AD"  # Next Icon
                              align: CENTER
                              text_color: cyan
                        on_release:
                          then:
                            - homeassistant.service:
                                service: pyscript.next_queue_song
                    - button:
                        id: previous_button
                        grid_cell_column_pos: 1
                        grid_cell_row_pos: 1
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F04AE"  # Previous Icon
                              align: CENTER
                              text_color: purple
                        on_release:
                          then:
                            - homeassistant.service:
                                service: media_player.media_previous_track
                                data:
                                  entity_id: media_player.${player_name}

                    - button:
                        id: volume_up_button
                        grid_cell_column_pos: 2
                        grid_cell_row_pos: 0
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F075D"  # Volume Up Icon  
          
                              align: CENTER
                              text_color: yellow
                        on_release:
                          then:
                            - homeassistant.service:
                                service: media_player.volume_up
                                data:
                                  entity_id: media_player.${player_name}

                    - button:
                        id: volume_down_button
                        grid_cell_column_pos: 2
                        grid_cell_row_pos: 1
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F075E"  # Volume Down Icon
                              align: CENTER
                              text_color: orange
                        on_release:
                          then:
                            - homeassistant.service:
                                service: media_player.volume_down
                                data:
                                  entity_id: media_player.${player_name}
                    - dropdown:
                        id: dropdown_id
                        grid_cell_column_pos: 0
                        grid_cell_row_pos: 2
                        width: 90
                        options: ${playlists_text}
                        bg_color: black
                        text_color: white
                        selected_index: 1
                        dropdown_list:
                          selected:
                            checked:
                              text_color: white #0xFF0000
                              
                        on_value:
                          then:
                            - lambda: |-
                                if (id(playlist_options).empty()) {
                                    id(playlist_options).push_back("Samochodowa|13452774-17c4-42e5-a15b-ef816b8bcb9d");
                                    id(playlist_options).push_back("Sorround|db5b3414-ca58-4560-a50b-0268366be8f2");
                                    id(playlist_options).push_back("Ulubione|50fe70a3-77b6-40e8-bd3e-2fc1e834038b");
                                    id(playlist_options).push_back("Sweta|1c59c757-778e-4d02-99da-7bfed7a33e2e");
                                }

                                int idx = id(dropdown_id).get_selected_index();
                                std::string id_only;

                                if (idx >= 0 && idx < id(playlist_options).size()) {
                                    std::string full = id(playlist_options)[idx];
                                    size_t sep = full.find("|");
                                    id_only = (sep != std::string::npos) ? full.substr(sep + 1) : full;
                                }
                                id(selected_playlist_id) = id_only;


                    - button:
                        id: switch_2
                        grid_cell_column_pos: 1
                        grid_cell_row_pos: 2
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F06A5"  # Kolumny
                              align: CENTER
                              text_color: purple
                        on_release:
                          then:
                            - homeassistant.service:
                                service: switch.toggle
                                data:
                                  entity_id: switch.${switch_2}

                    
                    - button:
                        id: switch_1
                        grid_cell_column_pos: 2
                        grid_cell_row_pos: 2
                        height: 24%
                        width: 24%
                        widgets:
                          - label:
                              text_font: icon_font_55
                              text: "\U000F06A5"  
                              align: CENTER
                              text_color: purple
                        on_release:
                          then:
                            - homeassistant.service:
                                service: switch.toggle
                                data:
                                  entity_id: switch.${switch_1}

  style_definitions:
    - id: header
      bg_color: 0x1d5f96
      bg_grad_color: 0x004466
      bg_grad_dir: VER
      bg_opa: 60%
      border_opa: TRANSP
      radius: 0
      pad_all: 0
      pad_row: 0
      pad_column: 0
      border_color: 0x0077b3
      text_color: 0xFFFFFF
      width: 100%
      height: 44
    - id: footer
      bg_color: 0x1d5f96
      bg_grad_color: 0x004466
      bg_grad_dir: VER
      bg_opa: 60%
      border_opa: TRANSP
      radius: 0
      pad_all: 0
      pad_row: 0
      pad_column: 0
      border_color: 0x0077b3
      text_color: 0xFFFFFF
      width: 100%
      height: 27
    - id: page_content
      bg_color: 0x000000
      width: 100%
      height: 100%
      pad_all: 0
      pad_row: 0
      pad_column: 0
      border_width: 0
font:
  - file: ${font_file}
    id: my_font
    size: 16
    glyphs:
      '${font_glyphs}'
  - file: ${icon_font_file}
    id: icon_font_55
    size: 40
    bpp: 4
    glyphs: &icon_glyphs

      - "\U000F008E"#mdi-battery-outline
      - "\U000F0091"#mdi-battery-unknown
      - "\U000F0020"#alarmclock
      - "\U000F009E"#bell
      - "\U000F0150"#clock
      - "\U000F01AE"#gbp pound symbol
      - "\U000F0210"#fan
      - "\U000F0238"#heating
      - "\U000F024A"#garden/flower
      - "\U000F0335"#light bulb off
      - "\U000F036C"#microphone on
      - "\U000F036D"#microphone off
      - "\U000F036F"#voice settings
      - "\U000F03E4"#pause
      - "\U000F040A"#play
      - "\U000F040E"#play/pause
      - "\U000F0493"#settings cog
      - "\U000F04AD"#next track
      - "\U000F04AE"#previous track
      - "\U000F04B9"#living room
      - "\U000F04C8"#spots
      - "\U000F04DB"#stop
      - "\U000F0502"#screen settings
      - "\U000F050F"#temp sensor
      - "\U000F051B"#timer
      - "\U000F0521"#toggle on
      - "\U000F0565"#arming
      - "\U000F057E"#speaker on
      - "\U000F0581"#speaker off
      - "\U000F05CB"#voice
      - "\U000F06A5"#power-plug
      - "\U000F068A"#alarm home
      - "\U000F068E"#alarm snooze
      - "\U000F06E8"#light bulb illuminated
      - "\U000F075A"#music
      - "\U000F075D"#vol plus
      - "\U000F075E"#vol minus
      - "\U000F0769"#ceiling
      - "\U000F07D0"#api connected
      - "\U000F07F4"#tv
      - "\U000F0873"#car miles non
      - "\U000F0874"#car miles full
      - "\U000F0875"#car miles low
      - "\U000F087B"#api disconnected
      - "\U000F08D6"#settings
      - "\U000F097E"#light switch
      - "\U000F099D"#alarm away
      - "\U000F099E"#disarmed
      - "\U000F0A19"#toggle off
      - "\U000F0B26"#down
      - "\U000F0B28"#left
      - "\U000F0B2A"#right
      - "\U000F0B2C"#up
      - "\U000F0B6C"#car battery
      - "\U000F0D90"#screen off
      - "\U000F0EBA"#stats
      - "\U000F0ED4"#voice off
      - "\U000F0FCE"#scene
      - "\U000F1061"#dining
      - "\U000F10CD"#battery warning
      - "\U000F1160"#kitchen
      - "\U000F12A8"#touch button
      - "\U000F12D3"#garage closed
      - "\U000F12D4"#garage open
      - "\U000F1322"#tools
      - "\U000F16BC"#wifidisconnected
      - "\U000F16BD"#wifi connected
      - "\U000F1722"#fire off
      - "\U000F1747"#tall lamp
      - "\U000F1828"#armed night
      - "\U000F192D"#electricity
      - "\U000F1987"#floods
      - "\U000F1A12"#home button
      - "\U000F1A1B"#gas
      - "\U000F1C3B"#battery charging/usb powered
      - "\U000F1C6F"#info
      - "\U000F05FA"#kettle
      - "\U000F070D"#vacuum
      - "\U000F0AAC"#dishwasher
      - "\U000F11B8"#dishwasheralert
      - "\U000F083B"#televisionoff
      - "\U000F033E"#lock
      - "\U000F033F"#lock-open
      - "\U000F00DF"#brightness 


# Konfiguracja przycisków na wyświetlaczu
# Buttony na ekranie (np. OLED) do wywoływania akcji
# Użyj przycisków na wyświetlaczu (np. dotykowych lub zwykłych, w zależności od wyświetlacza)

select:
  - platform: lvgl
    id: curr_playlist
    widget: dropdown_id
    name: Playlist
    restore_value: True
    
  

# Sensory stanu w ESPHome
text_sensor:


  - platform: homeassistant
    name: "Song Title"
    entity_id: media_player.${player_name}
    attribute: media_title
    id: song_title
    on_value:
      then:
        - lvgl.label.update:
            id: player_status   
            text: !lambda |-
                std::string status = id(playback_status).state;
                std::string title = id(song_title).state;
                std::string artist = id(song_artist).state;
                return artist + "\n" + title;

  - platform: homeassistant
    name: "Song Artist"
    entity_id: media_player.${player_name}
    attribute: media_artist
    id: song_artist
    on_value:
      then:
        - lvgl.label.update:
            id: player_status   
            text: !lambda |-
                std::string title = id(song_title).state;
                std::string artist = id(song_artist).state;
                return artist + "\n" + title;



  - platform: homeassistant
    name: "Playback Status"
    entity_id: media_player.${player_name}
    id: playback_status
    on_value:
      then:
        - lvgl.label.update:
            id: player_status   
            text: !lambda |-
              std::string status = id(playback_status).state;
              std::string title = id(song_title).state;
              std::string artist = id(song_artist).state;

              if (status == "playing") {
                return status + " " + artist + "\n" + title; 
              } else {
                return status;
              }

 

  - platform: homeassistant
    name: "sensor 1"
    entity_id: sensor.${sensor_1}
    id: sensor_1
    on_value:
      then:
        - lvgl.label.update:
            id: bottom_status   
            text: !lambda |-
                std::string s1 = id(sensor_1).state;
                std::string s2 = id(sensor_2).state;
                std::string s3 = id(sensor_3).state;
                std::string s4 = id(sensor_4).state;
                return s1 + "  |  " + s2 + "  |  "  + s3 + "  |  " + s4 ;


  - platform: homeassistant
    name: "sensor 1"
    entity_id: sensor.${sensor_2}
    id: sensor_2
    on_value:
      then:
        - lvgl.label.update:
            id: bottom_status   
            text: !lambda |-
                std::string s1 = id(sensor_1).state;
                std::string s2 = id(sensor_2).state;
                std::string s3 = id(sensor_3).state;
                std::string s4 = id(sensor_4).state;
                return s1 + "  |  " + s2 + "  |  "  + s3 + "  |  " + s4 ;

  - platform: homeassistant
    name: "sensor 1"
    entity_id: sensor.${sensor_3}
    id: sensor_3
    on_value:
      then:
        - lvgl.label.update:
            id: bottom_status   
            text: !lambda |-
                std::string s1 = id(sensor_1).state;
                std::string s2 = id(sensor_2).state;
                std::string s3 = id(sensor_3).state;
                std::string s4 = id(sensor_4).state;
                return s1 + "  |  " + s2 + "  |  "  + s3 + "  |  " + s4 ;
                
  - platform: homeassistant
    name: "sensor 4"
    entity_id: sensor.${sensor_4}
    id: sensor_4
    on_value:
      then:
        - lvgl.label.update:
            id: bottom_status   
            text: !lambda |-
                std::string s1 = id(sensor_1).state;
                std::string s2 = id(sensor_2).state;
                std::string s3 = id(sensor_3).state;
                std::string s4 = id(sensor_4).state;
                return s1 + "  |  " + s2 + "  |  "  + s3 + "  |  " + s4 ;


# Mirror media player state from Home Assistant